File operations

Sequential Files

Operation                    Action

open Fn Mode                 Open file Fn for use in mode "r for read,
                             "w for write; "a for append; "d for direct;
                             "c for communications. Returns F, an integer.

close F                      Close file designated by integer F.

readfile F                   Read a record from file F
writefile F R                Write record R to file F

.n Fout := open "tempfile "w
.n writefile Fout 'First record'
.n writefile Fout 'Second record'
.n close Fout
.p
.n Fin := open "tempfile "r
.n Rec gets readfile Fin
.n Rec gets readfile Fin
.n Rec gets readfile Fin

When there are no more records, the result is ??eof for end-of-file.

.n close Fin ;
.p
Operation                    Action

getfile Filename             Return the records of file Filename
putfile Filename Recs        Write Recs to file Filename
appendfile Filename Recs     Append Recs to the end of file Filename

getfile, putfile and appendfile do not require the file to be open.

.n recs := getfile "tempfile
.n appendfile "tempfile 'Third record'
.n recs gets getfile "tempfile
.p
Sequential Files

Getfile and Putfile

.n putfile "tempfile ['Another record','More still']
.n getfile "tempfile

putfile replaces whatever was in the file.
.p
Direct Access File Operations

A direct access file has two physical files; one an index, the other records

Operation            Action or Result

filetally F          Return the highest component number of the file
readarray F N        Return array component N from file designated by F
writearray F N B     Write array B to component N of file designated by F
eraserecord F N      Erase component N in the file designated by F

.n Fdir := open "tempfile "d

.n writearray Fdir 0 'This is the first record'
.n writearray Fdir (count 3) ['Rec1','Rec2','Rec3']
.n filetally Fdir
.p
.n readarray Fdir 2
.n eraserecord Fdir 2
.n readarray Fdir 2
.n readarray Fdir (tell filetally Fdir)
.n close Fdir
.p
Readrecord and Writerecord

If the first use of a direct access file is to write it using writerecord,
the components are strings; not arbitrary arrays.

All subsequent usage of that file must use readrecord or writerecord.
You cannot use readarray and readrecord operations on the same file.

If the record number used in readrecord is greater than filetally, the
record file is checked to see if it extends beyond the length indicated
by filetally. If it does, the file is assumed to consist of a sequence of
blocks of records of the structure indicated in the index file and the
record selected is determined by "N mod filetally F". This feature permits
reading the fields of a fixed length record.

See also pages 30-31 of the Language Manual
.p
